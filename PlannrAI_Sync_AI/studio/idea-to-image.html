<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Idea to Image - PlannrAI Studio</title>
    <link rel="stylesheet" href="master-tool.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <div class="left-panel">
            <div class="tool-header">
                <div class="breadcrumb">
                    <a href="index.html">‚Üê Studio</a> / Dream Canvas
                </div>
                <h1>üé® Idea to Image</h1>
                <p>Transform your text descriptions into stunning visuals with AI-powered image generation</p>
            </div>

            <div class="tool-form">
                <form id="imageForm">
                    <div class="form-group">
                        <label for="prompt">Describe Your Vision</label>
                        <textarea 
                            id="prompt" 
                            placeholder="Example: A futuristic conference room with holographic displays, modern furniture, and soft blue lighting for a tech event"
                            rows="6"
                            maxlength="1000"
                            required
                        ></textarea>
                        <div class="char-counter">
                            <span id="charCount">0</span>/1000 characters
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Style Suggestions</label>
                        <div class="style-tags">
                            <button type="button" class="style-tag" data-style="photorealistic, high quality, professional">Photorealistic</button>
                            <button type="button" class="style-tag" data-style="digital art, vibrant colors, modern">Digital Art</button>
                            <button type="button" class="style-tag" data-style="watercolor painting, soft, artistic">Watercolor</button>
                            <button type="button" class="style-tag" data-style="minimalist design, clean, simple">Minimalist</button>
                            <button type="button" class="style-tag" data-style="vintage style, retro, classic">Vintage</button>
                            <button type="button" class="style-tag" data-style="3D render, modern, sleek">3D Render</button>
                        </div>
                    </div>

                    <div class="form-row">
                        <button type="submit" class="generate-btn" id="generateBtn">
                            <span class="btn-text">‚ú® Generate Image</span>
                            <span class="btn-loading" style="display: none;">üé® Creating...</span>
                        </button>
                        <button type="button" class="secondary-btn" id="clearBtn">Clear</button>
                    </div>
                </form>

                <div class="example-prompts">
                    <h3>üí° Example Prompts</h3>
                    <div class="example-list">
                        <div class="example-item" data-prompt="Elegant wedding venue with fairy lights, white flowers, and romantic atmosphere">
                            <strong>Wedding Venue:</strong> Elegant space with fairy lights and flowers
                        </div>
                        <div class="example-item" data-prompt="Modern corporate event space with sleek furniture, large screens, and professional lighting">
                            <strong>Corporate Event:</strong> Modern space with professional setup
                        </div>
                        <div class="example-item" data-prompt="Outdoor festival stage with colorful banners, crowd of people, and sunset lighting">
                            <strong>Festival Setup:</strong> Outdoor stage with vibrant atmosphere
                        </div>
                        <div class="example-item" data-prompt="Birthday party decoration with balloons, cake table, and festive colors">
                            <strong>Birthday Party:</strong> Festive decorations and celebration setup
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="right-panel">
            <div class="chat-container">
                <div class="chat-header">
                    <h3>üñºÔ∏è Generated Images</h3>
                    <div class="credits-info" id="creditsInfo" style="display: none;">
                        <span id="remainingCredits"></span>
                    </div>
                </div>
                
                <div class="chat-messages" id="chatMessages">
                    <div class="welcome-message">
                        <div class="welcome-icon">üé®</div>
                        <h4>Ready to Create!</h4>
                        <p>Describe your vision in the prompt box and watch AI bring it to life. Be specific about colors, style, mood, and details for better results.</p>
                        
                        <div class="tips">
                            <h5>üí° Pro Tips:</h5>
                            <ul>
                                <li>Include lighting preferences (soft, dramatic, natural)</li>
                                <li>Specify the mood or atmosphere you want</li>
                                <li>Mention specific colors or color schemes</li>
                                <li>Add style keywords like "professional", "elegant", "modern"</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="loading-state" id="loadingState" style="display: none;">
                    <div class="loading-spinner"></div>
                    <p>Creating your image...</p>
                    <small>This may take 10-30 seconds</small>
                </div>
            </div>
        </div>
    </div>

    <script>
        class IdeaToImageTool {
            constructor() {
                this.promptInput = document.getElementById('prompt');
                this.charCount = document.getElementById('charCount');
                this.generateBtn = document.getElementById('generateBtn');
                this.clearBtn = document.getElementById('clearBtn');
                this.chatMessages = document.getElementById('chatMessages');
                this.loadingState = document.getElementById('loadingState');
                this.creditsInfo = document.getElementById('creditsInfo');
                this.remainingCredits = document.getElementById('remainingCredits');
                
                this.initializeEventListeners();
                this.updateCharCount();
            }

            initializeEventListeners() {
                // Form submission
                document.getElementById('imageForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.generateImage();
                });

                // Character counter
                this.promptInput.addEventListener('input', () => {
                    this.updateCharCount();
                });

                // Clear button
                this.clearBtn.addEventListener('click', () => {
                    this.clearForm();
                });

                // Style tags
                document.querySelectorAll('.style-tag').forEach(tag => {
                    tag.addEventListener('click', () => {
                        this.addStyleToPrompt(tag.dataset.style);
                    });
                });

                // Example prompts
                document.querySelectorAll('.example-item').forEach(item => {
                    item.addEventListener('click', () => {
                        this.promptInput.value = item.dataset.prompt;
                        this.updateCharCount();
                    });
                });
            }

            updateCharCount() {
                const length = this.promptInput.value.length;
                this.charCount.textContent = length;
                
                if (length > 800) {
                    this.charCount.style.color = '#f44336';
                } else if (length > 600) {
                    this.charCount.style.color = '#ff9800';
                } else {
                    this.charCount.style.color = '#666';
                }
            }

            addStyleToPrompt(style) {
                const currentPrompt = this.promptInput.value.trim();
                if (currentPrompt) {
                    this.promptInput.value = `${currentPrompt}, ${style}`;
                } else {
                    this.promptInput.value = style;
                }
                this.updateCharCount();
                this.promptInput.focus();
            }

            clearForm() {
                this.promptInput.value = '';
                this.updateCharCount();
                this.promptInput.focus();
            }

        async generateImage() {
            const prompt = document.getElementById('prompt').value.trim();
            
            if (!prompt) {
                this.showToast('Please enter a prompt', 'error');
                return;
            }

            if (prompt.length > 1000) {
                this.showToast('Prompt must be 1000 characters or less', 'error');
                return;
            }

            const generateBtn = document.getElementById('generateBtn');
            const originalText = generateBtn.textContent;
            
            generateBtn.textContent = 'Generating...';
            generateBtn.disabled = true;

            try {
                const response = await fetch('/generate-image', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ prompt: prompt })
                });

                if (response.ok) {
                    // Response is an image blob
                    const imageBlob = await response.blob();
                    const imageUrl = URL.createObjectURL(imageBlob);
                    
                    this.displayGeneratedImage(prompt, imageUrl);
                    this.showToast('Image generated successfully!', 'success');
                    
                    // Log credits info if available
                    const remainingCredits = response.headers.get('x-remaining-credits');
                    const creditsConsumed = response.headers.get('x-credits-consumed');
                    if (remainingCredits) {
                        console.log(`Credits remaining: ${remainingCredits}, consumed: ${creditsConsumed}`);
                    }
                } else {
                    // Try to parse error message
                    let errorMessage = 'Failed to generate image';
                    try {
                        const errorData = await response.json();
                        errorMessage = errorData.detail || errorMessage;
                    } catch (e) {
                        errorMessage = `Server error: ${response.status}`;
                    }
                    throw new Error(errorMessage);
                }
            } catch (error) {
                console.error('Error generating image:', error);
                this.showToast(error.message || 'Failed to generate image. Please try again.', 'error');
            } finally {
                generateBtn.textContent = originalText;
                generateBtn.disabled = false;
            }
        }            setLoading(isLoading) {
                if (isLoading) {
                    this.generateBtn.disabled = true;
                    this.generateBtn.querySelector('.btn-text').style.display = 'none';
                    this.generateBtn.querySelector('.btn-loading').style.display = 'inline';
                    this.loadingState.style.display = 'block';
                } else {
                    this.generateBtn.disabled = false;
                    this.generateBtn.querySelector('.btn-text').style.display = 'inline';
                    this.generateBtn.querySelector('.btn-loading').style.display = 'none';
                    this.loadingState.style.display = 'none';
                }
            }

            updateCreditsDisplay(remaining, consumed) {
                this.creditsInfo.style.display = 'block';
                this.remainingCredits.textContent = `Credits: ${remaining} remaining (${consumed} used)`;
            }

            displayGeneratedImage(prompt, imageUrl) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message assistant-message';
                
                messageDiv.innerHTML = `
                    <div class="message-header">
                        <strong>Generated Image</strong>
                        <span class="timestamp">${new Date().toLocaleTimeString()}</span>
                    </div>
                    <div class="prompt-used">
                        <strong>Prompt:</strong> "${prompt}"
                    </div>
                    <div class="generated-image">
                        <img src="${imageUrl}" alt="Generated image" style="max-width: 100%; border-radius: 8px; margin-top: 10px;">
                    </div>
                    <div class="image-actions">
                        <button onclick="downloadImage('${imageUrl}', '${prompt}')" class="download-btn">üì• Download</button>
                        <button onclick="regenerateImage('${prompt}')" class="regenerate-btn">üîÑ Regenerate</button>
                    </div>
                `;
                
                // Remove welcome message if it exists
                const welcomeMessage = this.chatMessages.querySelector('.welcome-message');
                if (welcomeMessage) {
                    welcomeMessage.remove();
                }
                
                this.chatMessages.appendChild(messageDiv);
                this.chatMessages.scrollTop = this.chatMessages.scrollHeight;
            }

            showError(message) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message error-message';
                messageDiv.innerHTML = `
                    <div class="message-header">
                        <strong>Error</strong>
                        <span class="timestamp">${new Date().toLocaleTimeString()}</span>
                    </div>
                    <p>${message}</p>
                `;
                
                this.chatMessages.appendChild(messageDiv);
                this.chatMessages.scrollTop = this.chatMessages.scrollHeight;
            }

            showToast(message, type = 'info') {
                const toast = document.createElement('div');
                toast.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : '#2196F3'};
                    color: white;
                    padding: 15px 20px;
                    border-radius: 8px;
                    z-index: 1001;
                    font-weight: 500;
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                    transform: translateX(100%);
                    transition: transform 0.3s ease;
                `;
                
                toast.textContent = message;
                document.body.appendChild(toast);
                
                // Animate in
                setTimeout(() => {
                    toast.style.transform = 'translateX(0)';
                }, 100);
                
                // Remove after 3 seconds
                setTimeout(() => {
                    toast.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        toast.remove();
                    }, 300);
                }, 3000);
            }
        }

        // Global functions for button actions
        window.downloadImage = function(imageUrl, prompt) {
            const link = document.createElement('a');
            link.href = imageUrl;
            link.download = `generated-image-${Date.now()}.png`;
            link.click();
        };

        window.regenerateImage = function(prompt) {
            document.getElementById('prompt').value = prompt;
            document.getElementById('generateBtn').click();
        };

        // Initialize the tool when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new IdeaToImageTool();
        });
    </script>
</body>
</html>

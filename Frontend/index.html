<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>PlannrAI Sync â€” Starting</title>
  <style>
    body{font-family:Inter,system-ui,Arial,sans-serif;margin:0;height:100vh;display:flex;align-items:center;justify-content:center;background:#061526;color:#fff}
    .card{background:linear-gradient(180deg,#09263a,#063048);padding:28px;border-radius:12px;box-shadow:0 20px 40px rgba(2,6,23,0.6);max-width:520px;width:90%;text-align:center}
    .status{margin-top:14px;padding:10px 12px;border-radius:8px;background:rgba(255,255,255,0.04)}
    .retry{margin-top:16px;padding:8px 12px;border-radius:8px;background:#10b981;border:none;color:#fff;cursor:pointer}
  </style>
</head>
<body>
  <div class="card">
    <h2>Starting PlannrAI Sync</h2>
    <p id="msg">Our AI is getting ready to plan the perfect event... ğŸ¯ (Render Cold Start)</p>
    <div class="status" id="status">Warming up the party engines...</div>
    <button class="retry" id="retry">Give it another shot! ğŸ²</button>
  </div>

<script>
  const statusEl = document.getElementById('status');
  const msgEl = document.getElementById('msg');
  const retryBtn = document.getElementById('retry');

  //const API_BASE = window.API_BASE || 'http://localhost:8080';
  const API_BASE = 'https://plannraisyncb.onrender.com'
  let retryCount = 0;
  let maxRetries = 10;

  const waitingMessages = [
    "Waking up the hamsters that power our servers...",
    "Teaching our AI to plan events... It just suggested a birthday party in space ğŸš€",
    "Convincing the database to share its secrets...",
    "Our servers are doing yoga to improve flexibility...",
    "Calibrating the event planning algorithms with coffee â˜•",
    "Asking the cloud if it's ready to party â˜ï¸",
    "Loading the secret sauce for perfect events...",
    "Our backend is getting dressed for the occasion ğŸ‘”",
    "Synchronizing with the universe's event calendar...",
    "Downloading more RAM... just kidding, checking real systems ğŸ˜„"
  ];

  const retryMessages = [
    "Servers must be stuck in traffic...",
    "Maybe our AI is planning its own birthday party?",
    "The database is playing hard to get...",
    "Our hamsters need more coffee apparently â˜•",
    "Servers are probably arguing about the best venue...",
    "The cloud seems a bit cloudy today â›…",
    "Backend is fashionably late as usual...",
    "Even our error messages are planning events now..."
  ];

  function getRandomMessage(messageArray) {
    return messageArray[Math.floor(Math.random() * messageArray.length)];
  }

  async function checkHealth() {
    statusEl.textContent = getRandomMessage(waitingMessages);
    try {
      const res = await fetch(API_BASE + '/api/venues/all', { method: 'GET' });
      if (res.ok) {
        statusEl.textContent = 'Perfect! Everything is ready to party ğŸ‰';
        setTimeout(() => { window.location.href = 'index1.html'; }, 600);
        return true;
      } else {
        statusEl.textContent = getRandomMessage(retryMessages) + ` (${res.status})`;
        return false;
      }
    } catch (e) {
      statusEl.textContent = getRandomMessage(retryMessages) + " (Connection failed)";
      return false;
    }
  }

  async function poll() {
    const ok = await checkHealth();
    if (!ok) {
      retryCount++;
      // Exponential backoff: 5s, 8s, 12s, 18s, 25s...
      const delay = Math.min(5000 + (retryCount * 3000), 30000);
      const funnyCounting = [
        "Taking a coffee break â˜•",
        "Doing server push-ups ğŸ’ª", 
        "Reading the manual ğŸ“–",
        "Asking IT for help ğŸ¤·â€â™‚ï¸",
        "Turning it off and on again ğŸ”„",
        "Sacrificing a USB cable to the tech gods ğŸ™",
        "Googling 'why is my server sad?' ğŸ˜¢",
        "Bribing the firewall with cookies ğŸª"
      ];
      
      const funnyMsg = retryCount <= funnyCounting.length ? funnyCounting[retryCount - 1] : "Still trying...";
      statusEl.textContent = `${funnyMsg} Retry ${retryCount}/${maxRetries} in ${Math.ceil(delay/1000)}s`;
      
      if (retryCount < maxRetries) {
        setTimeout(poll, delay);
      } else {
        statusEl.textContent = 'Our servers seem to be on vacation ğŸ–ï¸ Click retry to send a search party!';
      }
    } else {
      retryCount = 0; // Reset on success
    }
  }

  retryBtn.addEventListener('click', () => { 
    retryCount = 0; 
    poll(); 
  });

  // Start with initial 2-second delay to avoid immediate hammering
  setTimeout(() => {
    poll();
  }, 2000);
</script>
</body>
</html>